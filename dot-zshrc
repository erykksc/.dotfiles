#!/usr/bin/env zsh

# Load secrets
[ -f ~/.secrets ] && source ~/.secrets

# ALIASES
alias v='nvim'
alias vc='nvim .'
alias gs='git status'
alias ls='ls --color=auto -p -h'
alias s='~/.dotfiles/bin/tmux-client.sh'

# KEYBINDINGS
bindkey -e
# Move through history with the same prefix
bindkey '^P' history-search-backward
bindkey '^N' history-search-forward

# HISTORY
HISTSIZE=100000
HISTFILE=~/.zsh_history
SAVEHIST=$HISTSIZE
HISTDUP=erase
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE

setopt EXTENDED_GLOB

# FZF
# Set up fzf key bindings and fuzzy completion
if command -v fzf > /dev/null 2>&1; then
  source <(fzf --zsh)
fi

# Enable completions
fpath=(
  /opt/homebrew/share/zsh/site-functions
  /usr/share/zsh/site-functions
  /usr/local/share/zsh/site-functions
  $fpath
)
autoload -Uz compinit
compinit

if command -v direnv > /dev/null 2>&1; then
  eval "$(direnv hook zsh)"
fi

if command -v mise > /dev/null 2>&1; then
  eval "$(mise activate zsh)"
fi

# PLUGINS
ZPLUGINDIR=${XDG_DATA_HOME:-$HOME/.local/share}/zsh-plugins
mkdir -p $ZPLUGINDIR

# zsh-autosuggestions
if [[ ! -d $ZPLUGINDIR/zsh-autosuggestions ]]; then
  git clone https://github.com/zsh-users/zsh-autosuggestions \
    $ZPLUGINDIR/zsh-autosuggestions
fi
source $ZPLUGINDIR/zsh-autosuggestions/zsh-autosuggestions.plugin.zsh

# zsh-syntax-highlighting
if [[ ! -d $ZPLUGINDIR/zsh-syntax-highlighting ]]; then
  git clone https://github.com/zsh-users/zsh-syntax-highlighting \
    $ZPLUGINDIR/zsh-syntax-highlighting
fi
source $ZPLUGINDIR/zsh-syntax-highlighting/zsh-syntax-highlighting.plugin.zsh


# Set Bitwarden as SSH agent
if [[ "$(uname)" == "Darwin" ]]; then
    export SSH_AUTH_SOCK="$HOME/Library/Containers/com.bitwarden.desktop/Data/.bitwarden-ssh-agent.sock"
else
  # assume linux
  export SSH_AUTH_SOCK=$HOME/.bitwarden-ssh-agent.sock
fi

# turn on starship prompt if installed
if command -v starship > /dev/null 2>&1; then
  eval "$(starship init zsh)"
fi
